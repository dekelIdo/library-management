<mat-card class="book-form-container">
  <div class="form-header">
    <h2>
      <mat-icon>{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
      {{ isEditMode ? 'Edit Book' : 'Add New Book' }}
    </h2>
    <button 
      class="close-button" 
      (click)="onCancel()"
      type="button"
      aria-label="Close form"
    >
      Ã—
    </button>
  </div>

  <mat-card-content>
    <form [formGroup]="bookForm" (ngSubmit)="onSubmit()" class="book-form">
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Title *</mat-label>
          <input
            matInput
            formControlName="title"
            placeholder="Enter book title"
          />
          <mat-error *ngIf="getFieldError('title')">
            {{ getFieldError('title') }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Author *</mat-label>
          <input
            matInput
            formControlName="author"
            placeholder="Enter author name"
          />
          <mat-error *ngIf="getFieldError('author')">
            {{ getFieldError('author') }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Year</mat-label>
          <input
            matInput
            formControlName="year"
            placeholder="YYYY"
            maxlength="4"
          />
          <mat-error *ngIf="getFieldError('year')">
            {{ getFieldError('year') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>ISBN</mat-label>
          <input
            matInput
            formControlName="isbn"
            placeholder="ISBN number"
          />
          <mat-hint>International Standard Book Number - 10 or 13 digits</mat-hint>
          <mat-error *ngIf="getFieldError('isbn')">
            {{ getFieldError('isbn') }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Category *</mat-label>
          <mat-select formControlName="category" (selectionChange)="onCategoryChange()">
            <mat-option *ngFor="let category of predefinedCategories" [value]="category">
              {{ category }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="getFieldError('category')">
            {{ getFieldError('category') }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row" *ngIf="showCustomCategory">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Custom Category *</mat-label>
          <input
            matInput
            formControlName="customCategory"
            placeholder="Enter custom category"
          />
          <mat-error *ngIf="getFieldError('customCategory')">
            {{ getFieldError('customCategory') }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Description</mat-label>
          <textarea
            matInput
            formControlName="description"
            placeholder="Enter book description"
            rows="4"
          ></textarea>
        </mat-form-field>
      </div>


      <div class="form-row">
        <div class="image-upload-section">
          <label class="image-upload-label">Cover Image (optional)</label>
          <div class="image-upload-container">
            <input
              #fileInput
              type="file"
              accept="image/*"
              (change)="onImageSelected($event)"
              style="display: none"
            />
            
            <div class="image-preview-container">
              <div *ngIf="coverImagePreview" class="image-preview">
                <img [src]="coverImagePreview" alt="Book cover preview" class="preview-image">
                <div class="image-overlay">
                  <button 
                    mat-icon-button 
                    color="warn" 
                    (click)="removeImage()"
                    class="remove-image-btn"
                    type="button"
                    title="Remove image"
                  >
                    <mat-icon>close</mat-icon>
                  </button>
                  <div class="image-status">
                    <mat-icon>check_circle</mat-icon>
                    <span>Image selected</span>
                  </div>
                </div>
              </div>
              
              <div *ngIf="!coverImagePreview" class="no-image-preview">
                <img [src]="getDefaultBookImage()" alt="Default book cover" class="default-image">
                <div class="no-image-overlay">
                  <mat-icon>add_photo_alternate</mat-icon>
                  <span>No image selected</span>
                </div>
              </div>
            </div>
            
            <button 
              mat-stroked-button 
              type="button"
              (click)="fileInput.click()"
              class="upload-button"
              [class.has-image]="coverImagePreview"
            >
              <mat-icon>{{ coverImagePreview ? 'edit' : 'add_photo_alternate' }}</mat-icon>
              {{ coverImagePreview ? 'Change Image' : 'Upload Cover Image' }}
            </button>
          </div>
        </div>
      </div>
    </form>
  </mat-card-content>

  <mat-card-actions align="end">
    <button 
      mat-button 
      type="button" 
      (click)="onCancel()"
    >
      Cancel
    </button>
    <button 
      mat-raised-button 
      color="primary"
      type="submit"
      [disabled]="bookForm.invalid"
      (click)="onSubmit()"
    >
      <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
      {{ isEditMode ? 'Update Book' : 'Add Book' }}
    </button>
  </mat-card-actions>
</mat-card>
